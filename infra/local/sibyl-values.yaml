# Sibyl values for local development
# Uses local infrastructure (CNPG, FalkorDB, Kong)

backend:
  replicaCount: 1

  image:
    # For local dev with Tilt, this gets overridden
    repository: sibyl-backend
    pullPolicy: Never
    tag: dev

  # Reference secrets
  existingSecret: sibyl-secrets

  # Database connection - pulls all values from CNPG auto-generated secret
  # CNPG creates sibyl-postgres-app with: host, port, dbname, username, password, uri
  database:
    existingSecret: sibyl-postgres-app

  # FalkorDB connection
  falkordb:
    host: falkordb-redis-master
    port: "6379"
    existingSecret: sibyl-falkordb # Created by Tiltfile

  env:
    SIBYL_SERVER_HOST: "0.0.0.0"
    SIBYL_SERVER_PORT: "3334"
    SIBYL_ENVIRONMENT: "development"
    # Public URL - single source of truth for OAuth callbacks and redirects
    SIBYL_PUBLIC_URL: "https://sibyl.local"
    SIBYL_LLM_PROVIDER: "anthropic"
    SIBYL_LLM_MODEL: "claude-haiku-4-5"
    SIBYL_EMBEDDING_MODEL: "text-embedding-3-small"
    SIBYL_EMBEDDING_DIMENSIONS: "1536"

  # Relaxed resources for local
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi

  # Relaxed security for local dev (allows Tilt live_update)
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    readOnlyRootFilesystem: false

frontend:
  enabled: true
  replicaCount: 1

  image:
    # For local dev with Tilt, this gets overridden
    repository: sibyl-frontend
    pullPolicy: Never
    tag: dev

  # Relaxed resources for local
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 50m
      memory: 128Mi

  env:
    NODE_ENV: "development"
    HOSTNAME: "0.0.0.0"
    PORT: "3337"
    # Server-side API calls use internal K8s service
    SIBYL_API_URL: "http://sibyl-backend:3334/api"
    # Client-side uses relative paths through Kong ingress

  # Relaxed security for local dev
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    readOnlyRootFilesystem: false

# Worker configuration
worker:
  enabled: true
  replicaCount: 1

  # Relaxed resources for local
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 50m
      memory: 128Mi

  # Relaxed security for local dev
  podSecurityContext:
    runAsNonRoot: false
  securityContext:
    readOnlyRootFilesystem: false

# Ingress handled by Kong Gateway API resources
ingress:
  enabled: false

serviceAccount:
  create: true
